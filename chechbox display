<div class="block columnSet" style="float:left; width:50%;background:#d3dce3;margin-left:2%;margin-top:0.5%;">
    <div style="margin:0 auto;width:98%;">
      <form>
        <input type="button" value="選擇欄位" class="columnSel">
        <table border=1 style="margin-top:-1%;">
          <caption>欄位列表</caption>
          <thead>
            <th>類別代碼</th><th>類別名稱</th><th colspan=2>類別格式</th><th style="width:10%;"></th>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr style="display:none;" class="nodata"><td colspan=5><p>請選擇欄位</p></td></tr>
            <tr style="display:none;">
              <td><span style='font-size:22px;float:left;'>&#8693;</span></td><td></td><td></td><td></td>
              <td><input type="button" value="儲存" style="font-size:16px;" class="modBtn"></td>
            </tr>
            <tr style="display:none;" id="storeAll"><td colspan=5><input type="button" value="一鍵儲存" class="storeAll"></td></tr>
          </tfoot>
        </table>
      </form>
    </div>
</div>
  <div id="block"></div>
<div style="border:1px grey solid;display:none;" class="dis">
  <div style="border:1px solid black;margin:10% 10% 10%;background-color:#d3dce3;overflow: auto;max-height:400px;">
    <form id="fieldChoose"><table border=1 class="fieldChoose">
      <caption>類別列表</caption>
      <thead><th></th><th>欄位代碼</th><th>欄位名稱</th></thead>
      <tbody></tbody>
      <tfoot><tr><td colspan=3>
        <input type="button" value="確定" class="chk">
        <input type="reset" value="取消" class="del">
      </td></tr></tfoot>
    </table></form>
  </div>
</div>

<script>
$(function(){
let columnVal,columnName,array=[],delarray=[],coltype,tr;
  function nodata(){
    if($('.columnSet tbody tr').length<=0){
      $('.nodata').show();
      $('#storeAll').hide();
    } else {
      $('.nodata').hide();
      $('#storeAll').show();
    }
  }
  nodata();
  function getColumnVal(){    
    $('input[name="colChk"]').each(function(){
      if(($(this).prop('checked')==true) && ((array.indexOf(`${$(this).val()}`))== -1)){
        $(this).attr('checked',true);
        array.push($(this).val());
      	columnVal = $(this).val();
        columnName = $(this).parent().parent().find('td:last').text();
        coltype = parseInt($(this).parent().parent().find('td input:last').val());        
        tr = $('.columnSet tfoot tr').eq(1).clone(true);
        $(tr).find('td').eq(0).html(columnVal);
        $(tr).find('td').eq(1).html(columnName);
        switch(coltype){
          case 1:
            $(tr).find('td').eq(2).html(`<input type='text' placeholder='請輸入最大值' class='maxVal'>`);
            $(tr).find('td').eq(3).html(`<input type='text' placeholder='請輸入最小值'>`);
          break;
          case 2:
            $(tr).find('td').eq(2).attr('colspan',2).html(`<input type='text' placeholder='請輸入單一值'>`);
            $(tr).find('td').eq(3).css('display','none');
          break;
          case 3:
            $(tr).find('td').eq(2).attr('colspan',2).html(`<input type='text' placeholder='請輸入文字'>`);
            $(tr).find('td').eq(3).css('display','none');
          break;
          case 4:
            $(tr).find('td').eq(2).attr('colspan',2).html(`<select><option>通過</option><option>不通過</option></select>`);
            $(tr).find('td').eq(3).css('display','none');
          break;
        }
        $(tr).appendTo( $('.columnSet tbody') ).show();
      } 
      if($(this).prop('checked')==false){
        $(this).attr('checked',false);
        if(array.includes($(this).val())){
      	  array.splice(array.indexOf($(this).val()),1);
          $('.columnSet tbody').find(`tr:contains(${$(this).val()})`).remove();
        } 
      }
    })
    nodata();
  }
  $('.columnSel').on('click',function(){
    $('#block').show();
    $('.dis').show();
  })
  $('.chk').on('click',function(){
    $('#block').hide();
    $('.dis').hide();
    getColumnVal();    
    console.log('array:'+array);
    console.log('delarray:'+delarray);
  })
  $('.del').on('click',function(){
    $('#block').hide();
    $('.dis').hide();
    $('#fieldChoose')[0].reset();
  })

}
</script>
